# 脱出ゲーム機能テスト要件書

## 1. インベントリアイテム選択機能

### 完了条件
- [ ] **単一選択確認**: 1つのアイテムのみが選択状態になる
- [ ] **トグル動作確認**: 同じアイテムを2回タップすると選択が解除される
- [ ] **選択状態表示**: 選択されたアイテムに黄色の枠が表示される
- [ ] **選択メッセージ**: 選択時に「[アイテム名] を選択しました」メッセージが表示される
- [ ] **解除メッセージ**: 選択解除時に「選択を解除しました」メッセージが表示される
- [ ] **全アイテム選択可能**: key, code, tool すべてのアイテムが選択できる

### テストケース
1. **初期状態テスト**: 何も選択されていない状態
2. **key選択テスト**: keyアイテムをタップして選択される
3. **code選択テスト**: codeアイテムをタップして選択される  
4. **tool選択テスト**: toolアイテムをタップして選択される
5. **単一選択テスト**: key選択後にcodeを選択するとkeyの選択が解除される
6. **トグル選択テスト**: key選択後に再度keyをタップすると選択解除される

## 2. 日本語文字エンコーディング機能

### 完了条件
- [ ] **漢字表示**: 「鍵」「机」「本棚」「金庫」が正しく表示される
- [ ] **ひらがな表示**: 「ここから」「何か」「数字」が正しく表示される
- [ ] **メッセージ表示**: ゲーム内メッセージが文字化けせずに表示される
- [ ] **UTF-8処理**: String.fromCharCodes処理で文字化けが解消される
- [ ] **エラーなし**: ブラウザコンソールに文字関連エラーが表示されない

### テストケース
1. **基本漢字テスト**: 「鍵を選択しました」メッセージの表示確認
2. **複合文字テスト**: 「ここから脱出できそうだ」メッセージの表示確認
3. **特殊文字テスト**: 「数字の組み合わせが必要」メッセージの表示確認
4. **長文テスト**: 複数行にわたる日本語メッセージの表示確認

## 3. レスポンシブデザイン機能

### 完了条件
- [ ] **画面比率対応**: 異なる画面サイズで適切にレイアウト調整される
- [ ] **UIボタン分離**: ポーズ・再開ボタンがゲーム領域と重複しない
- [ ] **インベントリ配置**: インベントリアイコンが画面下部に適切配置される
- [ ] **ホットスポット配置**: ドア、机、本棚、金庫が適切な位置に配置される
- [ ] **テキストサイズ**: 画面サイズに応じてフォントサイズが調整される

### テストケース
1. **標準画面テスト**: 1920x1080での表示確認
2. **モバイル画面テスト**: 375x667での表示確認
3. **タブレット画面テスト**: 768x1024での表示確認
4. **ワイド画面テスト**: 2560x1440での表示確認

## 4. タップイベント処理機能

### 完了条件
- [ ] **onTapDown発火**: タップダウンイベントが正しく発火する
- [ ] **onTapUp発火**: タップアップイベントが正しく発火する
- [ ] **イベント順序**: onTapDown → onTapUp の順序で発火する
- [ ] **イベント伝播**: 適切なコンポーネントがイベントを受信する
- [ ] **コンポーネント存在**: タップ処理中にコンポーネントが削除されない

### テストケース
1. **基本タップテスト**: 単一タップでonTapDown/onTapUpが発火する
2. **連続タップテスト**: 連続タップで各イベントが正しく発火する
3. **複数コンポーネントテスト**: 重複するコンポーネントで適切にイベント処理される
4. **長押しテスト**: 長押し操作でonTapCancelが発火する

## 5. ゲーム状態管理機能

### 完了条件
- [ ] **初期状態**: exploring状態で開始する
- [ ] **アイテム取得**: 各ホットスポットでアイテムが正しく取得される
- [ ] **パズル解決**: 条件満足時にパズルが解決される
- [ ] **脱出成功**: 鍵を使ってドアを開けると脱出成功する
- [ ] **時間管理**: タイマーが正しく動作し時間切れ処理される

### テストケース
1. **初期化テスト**: ゲーム開始時の状態確認
2. **アイテム取得テスト**: 本棚からtool、机からcodeの取得確認
3. **パズル解決テスト**: codeを持って金庫をクリックでkeyが取得される
4. **脱出テスト**: keyを選択してドアをクリックで脱出成功
5. **時間切れテスト**: 制限時間経過でゲームオーバー

## テスト実行方法

```bash
# 静的解析
flutter analyze

# 単体テスト実行
flutter test

# 特定テストファイル実行
flutter test test/framework/escape_room_inventory_test.dart
flutter test test/framework/escape_room_encoding_test.dart
flutter test test/framework/escape_room_responsive_test.dart

# ブラウザテスト実行
flutter run -d chrome --web-port=8080
```

## 成功基準

- 全単体テストが通過する (100%成功率)
- flutter analyzeでエラーが0件
- ブラウザでの手動テストで全機能が動作する
- コンソールエラーが0件