# 第4章 アプリの日本語化対応、アセット管理、環境変数

本章では国際化対応、アイコンなどのアセット管理のしくみ、環境変数の取り扱いについて解説します。特に製品レベルのアプリを開発する際には、はじめに整えておくべき要素であり、さしずめ「開発の土台作り」と言えます。

また、これらの要素を整えるために必要なパッケージ管理についても併せて解説します。

# 4.1 パッケージやツールを導入する

Dart言語は標準でパッケージ管理ツールを提供しており、Flutterのプロジェクトで利用することができます。まず、混乱のないよう用語の解説を表4.1にまとめたので確認してください。

## 表4.1 パッケージに関する用語

| 用語 | 解説 |
|------|------|
| パッケージ | Dartのプログラムライブラリ、アプリ、リソースなどを含んだディレクトリ。パッケージそのものや依存関係を記述したpubspecファイルが必ず含まれる |
| プラグイン | ネイティブコード（iOS向けのSwiftコードやAndroid向けのKotlinコードなど）を同梱したパッケージ |
| pub | パッケージ管理ツール。パッケージを入手するために使う |
| pub.dev | 共有パッケージを閲覧、検索できるWebサイト。https://pub.dev |
| Flutter Favorite Program | 「最初に導入を検討すべきパッケージ」を選出する活動のこと。pub.devで公開されている |

pub.dev¹にはたくさんのパッケージが公開されています。サードパーティのプログラムライブラリのみならず、Flutterが公式で提供するパッケージもあります。カメラ操作、データ永続化、Firebase連携など、pub.devでパッケージを検索することで多くのユースケースに対応できるでしょう。本章でも後述のアセット管理のところで便利なパッケージを紹介します。

多くのパッケージはpubspec.yamlに所定の記述をし、コマンドを実行することで導入できます。ただし、導入に必要な手順はパッケージにより異なりますので、必ずそれぞれのドキュメントを参照してください。

---

¹ https://pub.dev

## パッケージの導入方法

pubspec.yamlにはパッケージを記述するセクションが2種類あります。以下にサンプルを示します。

```yaml
dependencies: # ❶
  flutter:
    sdk: flutter
  cupertino_icons: ^1.0.2
  http: ^0.13.6

dev_dependencies: # ❷
  flutter_test:
    sdk: flutter
  flutter_lints: ^2.0.0
  build_runner: ^2.3.3
```

`dependencies`セクションはアプリのコードが依存するパッケージを記述します（❶）。`dev_dependencies`は開発フェーズでのみ利用するパッケージを記述します。たとえばテストに関わるパッケージや、コード生成ツールなどです（❷）。

依存するパッケージを追加するには、YAML（YAML Ain't Markup Language）ファイルを直接編集するか、コマンドを実行します。たとえば、httpというパッケージを導入する場合は、以下のようにコマンドを実行すると`dependencies`セクションにhttpパッケージが追加されます。

```bash
$ flutter pub add http
```

`dev_dependencies`セクションに追加する際は`--dev`オプションを付与します。たとえば、build_runnerというパッケージを導入する場合は、以下のようにコマンドを実行します。

```bash
$ flutter pub add --dev build_runner
```

こうしてpubspec.yamlにパッケージを追加したら、コマンドを実行してパッケージを導入します。

```bash
$ flutter pub get
```

またはAndroid Studioには`pub get`コマンドを実行するためのボタンが用意されています。pubspec.yamlを開いている状態で「Pub get」ボタンを押すとパッケージを導入できます（図4.1）。

![図4.1 Android Studioの「Pub get」ボタン](図4.1)

## パッケージバージョンの指定方法

パッケージのバージョン指定には次のような記述方法があります。

```yaml
# 2.1.0以上、互換性のある限り最新のバージョンを利用する
shared_preferences: ^2.1.0  # ❶

# 2.1.0以上 3.0.0未満のバージョンを利用する
shared_preferences: '>=2.1.0 <3.0.0'  # ❷

# 2.1.0以下のバージョンを利用する
shared_preferences: '<=2.1.0'  # ❸

# 2.0.0より新しいバージョンを利用する
shared_preferences: '>2.0.0'  # ❹

# バージョンを2.1.1に固定する
shared_preferences: 2.1.1  # ❺
```# 第4章 アプリの日本語化対応、アセット管理、環境変数

本章では国際化対応、アイコンなどのアセット管理のしくみ、環境変数の取り扱いについて解説します。特に製品レベルのアプリを開発する際には、はじめに整えておくべき要素であり、さしずめ「開発の土台作り」と言えます。

また、これらの要素を整えるために必要なパッケージ管理についても併せて解説します。

# 4.1 パッケージやツールを導入する

Dart言語は標準でパッケージ管理ツールを提供しており、Flutterのプロジェクトで利用することができます。まず、混乱のないよう用語の解説を表4.1にまとめたので確認してください。

## 表4.1 パッケージに関する用語

| 用語 | 解説 |
|------|------|
| パッケージ | Dartのプログラムライブラリ、アプリ、リソースなどを含んだディレクトリ。パッケージそのものや依存関係を記述したpubspecファイルが必ず含まれる |
| プラグイン | ネイティブコード（iOS向けのSwiftコードやAndroid向けのKotlinコードなど）を同梱したパッケージ |
| pub | パッケージ管理ツール。パッケージを入手するために使う |
| pub.dev | 共有パッケージを閲覧、検索できるWebサイト。https://pub.dev |
| Flutter Favorite Program | 「最初に導入を検討すべきパッケージ」を選出する活動のこと。pub.devで公開されている |

pub.dev¹にはたくさんのパッケージが公開されています。サードパーティのプログラムライブラリのみならず、Flutterが公式で提供するパッケージもあります。カメラ操作、データ永続化、Firebase連携など、pub.devでパッケージを検索することで多くのユースケースに対応できるでしょう。本章でも後述のアセット管理のところで便利なパッケージを紹介します。

多くのパッケージはpubspec.yamlに所定の記述をし、コマンドを実行することで導入できます。ただし、導入に必要な手順はパッケージにより異なりますので、必ずそれぞれのドキュメントを参照してください。

---

¹ https://pub.dev

## パッケージの導入方法

pubspec.yamlにはパッケージを記述するセクションが2種類あります。以下にサンプルを示します。

```yaml
dependencies: # ❶
  flutter:
    sdk: flutter
  cupertino_icons: ^1.0.2
  http: ^0.13.6

dev_dependencies: # ❷
  flutter_test:
    sdk: flutter
  flutter_lints: ^2.0.0
  build_runner: ^2.3.3
```

`dependencies`セクションはアプリのコードが依存するパッケージを記述します（❶）。`dev_dependencies`は開発フェーズでのみ利用するパッケージを記述します。たとえばテストに関わるパッケージや、コード生成ツールなどです（❷）。

依存するパッケージを追加するには、YAML（YAML Ain't Markup Language）ファイルを直接編集するか、コマンドを実行します。たとえば、httpというパッケージを導入する場合は、以下のようにコマンドを実行すると`dependencies`セクションにhttpパッケージが追加されます。

```bash
$ flutter pub add http
```

`dev_dependencies`セクションに追加する際は`--dev`オプションを付与します。たとえば、build_runnerというパッケージを導入する場合は、以下のようにコマンドを実行します。

```bash
$ flutter pub add --dev build_runner
```

こうしてpubspec.yamlにパッケージを追加したら、コマンドを実行してパッケージを導入します。

```bash
$ flutter pub get
```

またはAndroid Studioには`pub get`コマンドを実行するためのボタンが用意されています。pubspec.yamlを開いている状態で「Pub get」ボタンを押すとパッケージを導入できます（図4.1）。

![図4.1 Android Studioの「Pub get」ボタン](図4.1)

## パッケージバージョンの指定方法

パッケージのバージョン指定には次のような記述方法があります。

```yaml
# 2.1.0以上、互換性のある限り最新のバージョンを利用する
shared_preferences: ^2.1.0  # ❶

# 2.1.0以上 3.0.0未満のバージョンを利用する
shared_preferences: '>=2.1.0 <3.0.0'  # ❷

# 2.1.0以下のバージョンを利用する
shared_preferences: '<=2.1.0'  # ❸

# 2.0.0より新しいバージョンを利用する
shared_preferences: '>2.0.0'  # ❹

# バージョンを2.1.1に固定する
shared_preferences: 2.1.1  # ❺
```