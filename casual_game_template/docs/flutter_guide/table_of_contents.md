# Flutter実践開発　iPhone／Android両対応アプリ開発のテクニック

**WEB+DB PRESS plus**

著者：渡部陽太 (Watanave Yohta)

---

## プロフェッショナルFlutterエンジニアへの道

### 技術要素
- Dart言語 / Riverpod / コード署名
- フレームワークによる最適化 / パッケージ管理  
- 国際化（日本語）対応 / アセット管理
- テーマ / 画面遷移 / パフォーマンス

**環境構築からリリースに必要なネイティブ知識まで**

*技術評論社*

---

## 免責事項

本書に記載された内容は、情報の提供のみを目的としています。したがって、本書の記述に従った運用は、必ずお客様自身の責任と判断によって行ってください。これらの情報の運用の結果について、技術評論社および著者はいかなる責任も負いません。

本書記載の情報は2024年1月時点のものですので、ご利用時には変更されている場合もあります。

本書に記載されているサンプルプログラムや操作による実行結果や画面図などは、特定の設定に基づいた環境で再現される一例です。

ソフトウェアに関する記述は、本文に記載してあるバージョンをもとにしています。ソフトウェアはバージョンアップされる場合があり、本書での説明とは機能内容や画面図などが異なってしまうこともあり得ます。本書ご購入の前に、必ずバージョン番号をご確認ください。

以上の注意事項をご承諾いただいたうえで、本書をご利用願います。注意事項をお読みいただかずにお問い合わせいただいても、技術評論社および著者は対処しかねます。あらかじめ、ご承知おきください。

本書に登場する製品名などは、一般に各社の商標または登録商標です。なお、本書中にTM、Ⓒ、Ⓡなどのマークは記載しておりません。

---

## はじめに

本書のコンセプトは「**プロフェッショナルなFlutterエンジニアになるための近道**」です。すでに他のプログラミング言語やフレームワークを習得している方に向けて、Flutterにチャレンジする際に手にとっていただく一冊として執筆しました。

クライアントワークを生業としている筆者は、これまでFlutter開発現場をいくつか目にしてきました。その経験を元に、多くの開発現場で求められる知識や、重要だけれど独学で学びにくいトピックを取り上げ、コンセプトである「プロフェッショナルなFlutterエンジニアになるための近道」を検討しました。Flutterフレームワークについては、基本から実際のプロジェクトで活用されるテクニックまで、焦点を絞って紹介しています。一方、Flutterの開発言語であるDartの言語仕様についてはできるだけ網羅的に解説しています。これは「新しいフレームワークに触れるときは、使用言語を頭にたたき込んでから」という筆者のスタイルを反映しています。

Flutterはマルチプラットフォーム対応ということもあり、スタートアップから大企業まで採用事例が増えています。開発者体験がよく、要件を満たしたアプリが作りやすいのはFlutterの特徴の一つです。しかし、中長期的に運用できる高い保守性をもったアプリにするためには、他のフレームワークと同様に相応の知識と経験が必要です。Flutterが多くのプロジェクトで採用されているいま、コンセプトである「プロフェッショナルなFlutterエンジニア」が市場で強く求められています。

*2024年1月*  
*渡部陽太*

---

## 検証環境

- **macOS Sonoma 14.3**
- **Flutter 3.16.9**
- **Dart 3.2.6**
- **Android Studio Hedgehog | 2023.1.1 Patch 2**
- **Xcode 15.2**

本書ではiOSとAndroidを対象としたモバイルアプリ開発についてのみ取り扱います。iOSを開発対象にすることもあり、本書ではmacOS環境についてのみ取り扱います。シェルは最新のmacOSに合わせてzshとします。

## 対象読者

何らかのプログラミング言語やフレームワークを習得している方を対象にしています。静的型付け言語やUIフレームワークの前提知識があると読み進めやすいでしょう。iOSエンジニアまたはAndroidエンジニアで、これからFlutterを学びたい方には特にマッチするでしょう。

## 本書の特徴

Flutterの環境構築にはじまり、フレームワークの基礎から実践的なテクニックまで解説します。Flutterにはフレームワークの中心となるウィジェットというクラスがあります。本書ではウィジェットを使った小さなプログラムを実装しながら基礎を学びます。重要なクラスであるため後半では内部のしくみにも踏み込んで解説し、パフォーマンスを意識した実装のコツについても紹介します。

ただ、このウィジェットはたくさんのバリエーションがあり、本書ではリファレンスのように広く紹介はしません。ウィジェットの理解を深めるのが本書の位置付けです。多くのウィジェットを知りたくなったらFlutter公式Webサイトの「Widget catalog」のページや、YouTubeのプレイリスト「Flutter Widget of the Week」がお勧めです。

https://docs.flutter.dev/ui/widgets

また、サンプルコードに掲載されたウィジェットや関連クラスについて、詳しく知りたい場合は公式のリファレンスを参照してください。

https://api.flutter.dev/flutter/widgets/widgets-library.html

本書はDart公式Webサイト<sup>注1</sup>、およびFlutter公式Webサイト<sup>注2</sup>の内容を一部引用しています。Dart公式WebサイトはCC BY 4.0<sup>注3</sup>とBSD-3-Clause<sup>注4</sup>のもとでライセンスされています。Flutter公式WebサイトはCC BY 4.0<sup>注5</sup>とBSDのもとでライセンスされています。

## 本書の構成

第1章では環境構築を行います。ご自身のMacを操作しながら読み進めてください。

第2章では開発言語のDartを学びます。必要に応じて読み飛ばしていただいてもかまいません。気になった要素を後から確認しても良いでしょう。

第3章から第8章まではFlutterの基礎から応用まで、ハンズオンを交えながら理解を深めます。第3章はコードを写経しながら読み進めてください。以降は第4～5章を読んで第6章で手を動かすハンズオン、第7章を読んで第8章で再びハンズオンといった具合に進行します。

第9章と第10章ではフレームワークの内部を覗き、パフォーマンスについて学びます。

最後に第11章ではiOS／Androidのネイティブ開発についての解説をします。

なお、本書は技術評論社の『WEB+DB PRESS Vol.130』の特集として掲載された「いまはじめるFlutter」の内容をベースに、詳細な説明の加筆や最新の状況を踏まえたトピックの変更を行っています。

### 参考リンク

- <sup>注1</sup> https://dart.dev/
- <sup>注2</sup> https://docs.flutter.dev/
- <sup>注3</sup> https://creativecommons.org/licenses/by/4.0/
- <sup>注4</sup> https://opensource.org/license/bsd-3-clause/
- <sup>注5</sup> https://creativecommons.org/licenses/by/4.0/

---

## 本書のサンプルプログラムについて

本書のサンプルプログラムは、下記のGitHubにて公開しています。

https://github.com/watanavex/flutter-dev-book

## 本書の正誤情報や追加情報について

本書の正誤情報や追加情報は、下記のサポートサイトにて公開しています。

https://gihyo.jp/book/2024/978-4-297-13993-3

## 謝辞

Flutterをキャッチアップし始めた頃からアドバイスをくださり、この書籍のベースとなった特集記事のレビューにも携わってくれたmonoさん。monoさんから頂いた助言の数々が、この書籍のゴールを照らしてくれました。

執筆にあたり、Flutterの興味深い開発経験をさせてくださったsu-さん、maemaeさんに感謝を伝えたい。みなさんから頂いた経験が執筆の勇気をくれました。

レビューに関わってくれた株式会社ゆめみの同僚たち。おかやまん、json、いせりゅうさん、田畑さん、りずさん、しまもんさん、でんでんさん、やまぱんさん。この分量の書籍を、細やかに丁寧にレビューしてくださり感激しました。みなさんのおかげで、私の書いたコンテンツが書籍として大きく前進しました。ありがとう。

編集者の菊池さん。菊池さんの「この書籍を少しでも良いものにしよう」という姿勢が、折れそうな私の心を何度蘇らせたことでしょう。初めから最後まで並走してくださり感謝です。

最後に、常にそばで支えてくれた妻に感謝を伝えたい。締切恐怖症である私をよく理解したあなたの放つ「大丈夫」の言葉にどれだけ励まされたことか。

そして、心の支えである2人の息子たち。休日返上での執筆作業が続き、寂しい思いをさせたよね。日向、日彩、今度の休日は水族館に行こう！

---

# 目次
# 目次（続き）

## 第2章　Dartの言語仕様（続き）

### 2.5　制御構文　39

#### 分岐　39
- **if文**　39
- **if-case文**　39  
- **switch文**　40
- **式としてのswitch**　41

#### ループ　42
- **for文**　42
- **while文**　43
- **breakとcontinue**　43

### 2.6　パターン　44

#### マッチング機能しか持たないパターン　44
- 論理演算子、比較演算子　44
- 一致判定　45

#### マッチングと分解宣言の2つの機能を持つパターン　46
- **List**　46
- **Map**　46
- **Record**　46
- **Object**　47
- **Tips** for-in文での分解宣言　48

#### パターンを補助する構文　49
- キャスト　49
- nullチェック　49
- nullアサーション　49
- ワイルドカード　50

### 2.7　例外処理　50
- 例外の型　ErrorとException　51
- 例外の捕捉　51
- 例外の再スロー　52
- finally句　52
- アサーション　52
- Flutterの例外処理　53

### 2.8　コメント　54

### 2.9　null安全　55
- null許容演算子　55
- null認識演算子　55
- nullアサーション演算子　55
- タイププロモーション　56
- そのほかの便利なnull関連演算子　56

### 2.10　ライブラリと可視性　57

### 2.11　関数　57

#### 引数　57
- 省略可能引数　58
- 名前付き引数　58

- 関数の省略記法　59
- 第一級関数と匿名関数　59

### 2.12　クラス　61

#### ゲッタとセッタ　62

#### いろいろなコンストラクタ　62
- **constantコンストラクタ**　63
- **名前付きコンストラクタ**　64
- **factoryコンストラクタ**　64

#### クラス継承　65
- スーパークラスのコンストラクタ　66

#### 暗黙のインタフェース　67
#### 拡張メソッド　68
#### mixin　クラスに機能を追加する　69

#### Enum　70
- Enumの宣言　70
- Enumの利用　71

#### クラス修飾子　72
- **abstract**　73
- **base**　73
- **interface**　75
- **abstractとinterfaceの組み合わせ**　76
- **final**　76
- **mixin**　77
- **sealed**　77

### 2.13　非同期処理　78

#### Future型　78
- エラーハンドリング　79

#### Stream型　81
- Streamの購読をキャンセル、一時停止する　81
- Stream型を生成する関数　82
- Streamの終わり　83
- エラーハンドリング　84
- **StreamController**　85
- ブロードキャスト　87
- Streamを変更する　88

#### Zone　非同期処理のコンテキスト管理　88

#### アイソレート　90
- Flutterアプリとアイソレート　90

### 2.14　まとめ　92

---

## 第3章　フレームワークの中心となるWidgetの実装体験
*StatelessWidget、StatefulWidget*　93

### 3.1　DartPadでアプリ開発を体験しよう　94

### 3.2　状態を持たないWidget　StatelessWidget　96
- 独自のStatelessWidgetを定義する　98

### 3.3　状態を持つWidget　StatefulWidget　100
- Widgetのタップ操作を検知する　101
- StatefulWidgetを継承する　102
- Widgetの状態を変化させる　104

### 3.4　まとめ　105

---

## 第4章　アプリの日本語化対応、アセット管理、環境変数　107

### 4.1　パッケージやツールを導入する　108
- パッケージの導入方法　109
- パッケージバージョンの指定方法　110
- パッケージバージョンの更新方法　111
- **Tips** セマンティックバージョニングについて　111

### 4.2　アプリを日本語に対応させる　113

#### 意図せず英語表示されるケース　114
- フレームワークが提供する表示文字列　114
- 日付フォーマット　115

#### アプリを日本にローカライズする　117
- フレームワークが提供する表示文字列を日本語化する　117
- 日付フォーマットを日本語化する　119
- iOSアプリの対応言語を設定する　121

#### メッセージをローカライズする　121
- コードジェネレータを設定する　121
- arbファイルを作成する　122
- ローカライズされたメッセージを表示する　123

#### arbファイルの扱い方　125
- プレースホルダ　125
- 単数形と複数形の対応　126
- 複数の言語への対応　128

### 4.3　プロジェクトにアセットを追加する　129
- アプリに画像を追加する　129
- 端末の解像度に応じて画像を切り替える　131

#### flutter_gen　型安全にアセットを扱うパッケージ　133
- flutter_genを導入する　133
- SVG画像の利用　134
- その他のアセット　137

### 4.4　dart-define-from-file　環境変数を扱う　137
- 環境変数をJSON形式で記述する　137
- 環境変数をコードから参照する　138

### 4.5　まとめ　139

---

## 第5章　テーマとルーティング　141

### 5.1　テーマ　アプリ全体のヴィジュアルを管理　142
- フレームワークによるテーマの自動計算機能　142
- ダークモード対応　146
- アプリ独自のテーマ管理　147
- Theme Extensionを利用したアプリのサンプル　150
- **Tips** Cupertino（クパチーノ）デザイン　152

### 5.2　ナビゲーションとルーティング　画面遷移を実現する3つの手法　152

#### NavigatorウィジェットとRouteクラスによる画面遷移　Navigator 1.0　154
- 画面間でのデータの受け渡し　158

#### 名前付きルートによる画面遷移　Navigator 1.0（非推奨）　161
- 名前付きルートの制限事項　166

#### Routerウィジェットによる画面遷移　Navigator 2.0　167
- go_routerによる画面スタックの書き換えを体験する　167
- GoRouteで入れ子構造を作る　170
- goとpushの違い　175

### 5.3　まとめ　180

---

## 第6章　実践ハンズオン❶　画像編集アプリを開発　181

### 6.1　開発するアプリの概要　182
- スタート画面　182
- 画像選択画面　183
- 画像編集画面　184
- 開発の土台づくり　185
- テーマと画面遷移の方針　185

### 6.2　プロジェクトを作成する　185
- 開発の土台づくり　186

### 6.3　アプリ起動後のスタート画面を作成する　186
- レイアウトを作成する　188

### 6.4　テーマをアレンジする　190

### 6.5　アプリを日本語化する　190
- パッケージを導入する　190
- ローカライズの構成ファイルを作成する　191
- arbファイルを作成する　191
- ローカライズされたメッセージを適用する　192
- App Storeでの表示言語を設定する　194

### 6.6　画像選択画面を作成する　195
- メッセージを追加する　195
- レイアウトを作成する　196

#### 画像ライブラリから画像を取得する　198
- パッケージを導入する　198
- iOSネイティブの設定を行う　199
- 画像を取得する処理を実装する　199
- 画像取得処理をWidgetに組み込む　201

### 6.7　画像編集画面を作成する　203
- メッセージを追加する　203
- レイアウトを作成する　204
- 画像編集画面への遷移を実装する　205
- アイコンを追加する　flutter_genによるアセット管理　207
- 画像を編集する処理を実装する　210

### 6.8　まとめ　212
- **Tips** WidgetとStateのライフサイクルについて　213

---

## 第7章　状態管理とRiverpod　215

### 7.1　Flutterアプリにおける状態管理　216

### 7.2　Riverpodとはどのようなパッケージか　217
- **Tips** 宣言的UIとしてのFlutter　217
- Riverpodの主要なクラス　218
- 実装サンプル　218

### 7.3　Riverpodの関連パッケージ　221
- 基本機能を提供するパッケージ　221
- Providerのコードを生成するパッケージ　222
- 静的解析を行うパッケージ　223
- 関連パッケージまとめ　223

### 7.4　Riverpodの使い方　224

#### Providerの種類　224
- 関数ベースのProvider　224
- クラスベースのProvider　225

#### 非同期処理を行うProvider　227
- 非同期なProviderとRaw型　229

#### Providerから値を取得する　230
- Providerの値をフィルタする　231

#### Providerのライフサイクル　231
#### Providerにパラメータを渡す　232

### 7.5　まとめ　234

---

## 第8章　実践ハンズオン❷　ひらがな変換アプリを開発　235

### 8.1　開発するアプリの概要　236
- 入力状態　237
- レスポンス待ち状態　237
- 変換完了状態　238
- 開発の土台づくり　239
- テーマと画面遷移の方針　239

### 8.2　プロジェクトを作成する　239

### 8.3　アプリで使用するパッケージを導入する　240
- riverpod_lintを設定する　241

### 8.4　入力状態のウィジェットを実装する　241
- レイアウトを作成する　241
- レイアウトを表示する　243
- 入力値のバリデーションを行う　244

### 8.5　入力文字を取得する　246

### 8.6　ひらがな化するWeb APIを呼び出す実装をする　248
- リクエスト、レスポンスオブジェクトを定義する　249
- アプリケーションIDを設定する　251
- Web APIを呼び出す　251

### 8.7　アプリの状態を管理する　254
- 状態を表現するクラスを作成する　254

### 8.8　状態に応じて表示を切り替える　256
- レスポンス待ち状態のウィジェットを実装する　256
- 変換完了状態のウィジェットを実装する　257
- 画面の切り替えを行う　258
- ひらがな変換処理の呼び出しを修正する　259

### 8.9　まとめ　262

---

## 第9章　フレームワークによるパフォーマンスの最適化
*BuildContext、Key*　263

### 9.1　BuildContextは何者なのか　Element　264
- 祖先の情報にアクセスできるBuildContext　264
  - Elementがツリーを構成していく工程　265
- StatefulWidgetの状態を保持する役割　268
- **Tips** 宣言的UIとElementの再利用　273

### 9.2　Elementの再利用とパフォーマンス　RenderObject　273
- RenderObjectは高コストな計算を行う　274
- RenderObjectは状態を持つ　274
- Elementの再利用はパフォーマンスに影響する　275

### 9.3　Keyは何に使うのか　275
- Elementが再利用される条件　276
- Elementが再利用される様子を見てみよう　276
  - Keyを利用したElementの再利用　279
- Keyの種類　281

### 9.4　局所的にWidgetを更新するしくみ　InheritedWidget　282

### 9.5　まとめ　284# 目次（続き）

## 第10章　高速で保守性の高いアプリを開発するためのコツ　285

### 10.1　パフォーマンスと保守性、どちらを優先すべきか　286
- 高速でないアプリとは　286
- 高速だが保守性が低い実装　286

### 10.2　高速で保守性の高い実装　287
- **buildメソッドで高コストな計算をしない**　287
- **buildメソッドで大きなウィジェットツリーを構築しない**　289
  - ウィジェットツリーの階層が浅くなるようウィジェットの選択を見なおす　289
- **const修飾子を付与する**　291
  - const修飾子が使えるようウィジェットの選択を見なおす　292
  - 独自のウィジェットクラスにconstantコンストラクタを実装する　292
- **状態を末端のウィジェットに移す**　297
- **Riverpodの状態監視は末端のウィジェットで行う**　300
- **Tips** アプリのパフォーマンスを計測する　303

### 10.3　まとめ　304

---

## 第11章　Flutterアプリ開発に必要なネイティブの知識　305

### 11.1　ネイティブAPIのバージョンと最低サポートOSのバージョン　306

#### 最低サポートOSのバージョン　306
- iOSの最低サポートOSバージョンを設定する　308
- **Tips** XcodeのBuild Settings　308
- Androidの最低サポートOSバージョンを設定する　310

#### ビルドSDKバージョン　310
- iOSのビルドSDKバージョンの設定　310
- AndroidのビルドSDKバージョンの設定　310

#### ターゲットSDKバージョン　311

### 11.2　アプリの設定変更　312

#### アプリ名　312
- iOSのアプリ名を変更する　312
- Androidのアプリ名を変更する　312

#### アプリアイコン　313
- iOSのアプリアイコンを変更する　313
- Androidのアプリアイコンを変更する　314
- アプリアイコンを手軽に生成するパッケージ　315

#### スプラッシュ画面　316
- iOSとAndroidで異なるスプラッシュ画面の位置付け　316
- iOSのスプラッシュ画面　316
- Androidのスプラッシュ画面　317
- スプラッシュ画面を手軽に実現するパッケージ　317

#### アプリのID　319
- iOSのアプリIDを設定する　319
- AndroidのアプリIDを設定する　320

### 11.3　アプリの配布とコード署名　320

#### iOSのコード署名　321
- 管理の難しい秘密鍵　321
- アプリに署名する　322

#### Androidのコード署名　326

#### apkファイルとaabファイル　327
- アプリに署名する　327
- aabファイルをアップロードする　330

### 11.4　まとめ　334

---

## 付録
- **参考Web情報**　335
- **著者プロフィール**　335
- **索引**　336

---

