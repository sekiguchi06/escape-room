# AI作業指示書 - フレームワーク完成作業

## 🤖 AIエージェント向け作業ルール

### 必須読み込みファイル
作業開始前に以下のファイルを必ず確認：
1. `/project_management/framework_completion_roadmap.md` - 全体計画
2. `/project_management/task_breakdown_details.md` - 詳細実装方法
3. `/docs/framework_specification.md` - 技術仕様
4. `/CLAUDE.md` - プロジェクト固有ルール

### タスク実行手順（厳守）

#### 1. 作業開始時
```bash
# 1. ロードマップで現在位置確認
# 2. 実装対象のタスク詳細確認
# 3. 既存コードとの整合性確認
# 4. 必要な依存関係確認
```

#### 2. 実装時
```bash
# 1. インターフェース定義確認
# 2. テストケース先行作成
# 3. 実装（エラーハンドリング含む）
# 4. 単体テスト実行・合格確認
```

#### 3. 完了時
```bash
# 1. 統合テスト実行
# 2. ブラウザシミュレーション確認
# 3. ドキュメント更新
# 4. ロードマップ進捗更新
```

## 🎯 現在の優先タスク

### Phase 1: 実プロバイダー実装（最優先）

#### Task 1.1: GoogleAdProvider実装
**ファイル**: `lib/framework/monetization/providers/google_ad_provider.dart`
**期限**: 即座
**受け入れ条件**:
- [ ] Google Mobile Ads SDKの統合
- [ ] テスト広告ID使用での動作確認
- [ ] Banner/Interstitial/Rewarded全対応
- [ ] エラーハンドリング実装
- [ ] 単体テスト合格率100%

#### Task 1.2: FirebaseAnalyticsProvider実装
**ファイル**: `lib/framework/analytics/providers/firebase_analytics_provider.dart`
**期限**: Task 1.1完了後
**受け入れ条件**:
- [ ] Firebase Analytics SDKの統合
- [ ] カスタムイベント送信確認
- [ ] ユーザープロパティ設定確認
- [ ] バッチ送信機能実装
- [ ] 単体テスト合格率100%

#### Task 1.3: AudioPlayersProvider実装
**ファイル**: `lib/framework/audio/providers/audioplayers_provider.dart`
**期限**: Task 1.2完了後
**受け入れ条件**:
- [ ] 実音声ファイル再生確認
- [ ] BGM・効果音同時再生確認
- [ ] 音量調整・フェード機能
- [ ] メモリリーク防止実装
- [ ] 単体テスト合格率100%

## 📋 実装時の厳守事項

### コーディング規約
- **プロバイダーパターン**: 必ずAdProvider/AnalyticsProvider等のインターフェースを実装
- **エラーハンドリング**: try-catch文必須、適切なログ出力
- **設定駆動**: Configurationクラスの値を参照
- **テスト**: 実装と同時にテストコード作成

### 品質基準
- **テスト合格率**: 100%（例外なし）
- **パフォーマンス**: 60FPS維持、メモリリークなし
- **互換性**: 既存インターフェースとの完全互換
- **ドキュメント**: APIコメント・使用例記載

### 禁止事項
- **設計変更**: 既存のプロバイダーパターンの変更禁止
- **インターフェース変更**: AdProvider等の既存インターフェース変更禁止
- **テスト省略**: 単体テスト・統合テストの省略禁止
- **互換性破綻**: 既存の実装に影響を与える変更禁止

## 🔍 テストの必須実行手順

### 1. 単体テスト
```bash
flutter test test/framework_extended_test.dart
# 必須: 全テスト合格（6/6成功）
```

### 2. システムテスト
```bash
flutter test test/system/simplified_system_test.dart
# 必須: 全テスト合格（3/3成功）
```

### 3. 自動ブラウザテスト
```bash
./scripts/run_automated_browser_test.sh
# 必須: 全テスト合格、エラー0件
```

### 4. 新機能テスト
```bash
# 新規実装した機能の個別テスト実行
# 例: flutter test test/providers/google_ad_provider_test.dart
```

## 📝 進捗報告フォーマット

### タスク開始時
```
## [Task X.X] 開始報告
- **タスク**: [タスク名]
- **開始時刻**: [日時]
- **予定完了**: [日時]
- **確認事項**: [既存コード確認結果]
```

### タスク完了時
```
## [Task X.X] 完了報告
- **タスク**: [タスク名]
- **完了時刻**: [日時]
- **実装ファイル**: [作成・変更ファイル一覧]
- **テスト結果**: 
  - 単体テスト: [X/X成功]
  - 統合テスト: [成功/失敗]
  - ブラウザテスト: [成功/失敗]
- **次のタスク**: [次に実行すべきタスク]
```

## 🚨 エラー発生時の対応手順

### 1. テスト失敗時
1. エラーメッセージの詳細確認
2. 既存コードとの競合チェック
3. 依存関係の確認
4. 段階的デバッグ実行
5. 解決できない場合は詳細報告

### 2. 実装ブロック時
1. 既存の類似実装を参照
2. Flutter/Flame公式ドキュメント確認
3. エラーログの詳細分析
4. 代替アプローチの検討
5. 詳細な状況報告

### 3. 設計判断が必要な場合
1. 現在の実装パターンを維持
2. 既存インターフェースとの互換性優先
3. 最小限の変更で目標達成
4. 判断根拠を明確に記載

## 🎯 成功指標

### Phase 1完了条件
- [ ] GoogleAdProvider実装・テスト合格
- [ ] FirebaseAnalyticsProvider実装・テスト合格  
- [ ] AudioPlayersProvider実装・テスト合格
- [ ] 既存機能との非干渉確認
- [ ] 自動ブラウザテスト全合格

### 総合成功指標
- [ ] フレームワーク流用準備度: 70% → 85%達成
- [ ] 実プロバイダー実装率: 0% → 100%達成
- [ ] 他アプリ流用時の追加実装工数: 50%削減
- [ ] 月4本リリース目標への基盤完成

この指示書に従うことで、AIは効率的かつ確実にフレームワーク完成作業を進めることができます。