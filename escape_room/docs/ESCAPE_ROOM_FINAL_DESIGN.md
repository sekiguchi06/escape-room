# 脱出ゲーム最終設計書 - 封印された貴族の館

**作成日**: 2025-08-25  
**ステータス**: 最終版  
**概要**: ユーザビリティを重視した多階層脱出ゲーム完全設計

## 📋 設計概要

### 基本仕様
- **階層構成**: 1階5部屋 + 地下5部屋 + 隠し部屋4つ
- **アイテム総数**: 8個（1階4個 + 地下4個）
- **最大同時保持**: 3個（ユーザビリティ重視）
- **合成回数**: 2回のみ（1階1回 + 地下1回）
- **プレイ時間**: 35-50分
- **ホットスポット**: 45箇所（全箇所に意味のある機能）

### 制約達成
- ✅ インベントリ5個制限内（実際は3個最大）
- ✅ 隠し部屋4つ全て必須
- ✅ アイテム使い切り（8個全消費）
- ✅ 階層完結（1階は1階で、地下は地下で完結）
- ✅ 視覚的ヒントのみ（テキストなし）

---

## 🏠 1階詳細設計

### アイテム配置
```
基本部屋取得（2個）:
- noble_seal（伯爵の印章）- 肖像画の回廊
- ancient_fragment（古代の欠片）- 錬金術研究室

隠し部屋取得（2個）:
- mystic_herb（神秘の薬草）- 隠し部屋A ※パズル解除で進入
- enhancement_stone（強化石）- 隠し部屋B ※mystic_herb消費で進入

合成ルール:
noble_seal + ancient_fragment + enhancement_stone → chamber_key
```

### ホットスポット配置（15箇所）

#### 大図書室（center）- ゲーム開始地点
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `main_exit_door` | 🚪 最終脱出 | liberation_key で脱出 |
| `grand_desk` | ⚗️ アイテム合成 | 1階合成場所 |
| `ancient_tome` | 🎨 視覚ヒント | 本に3つのシンボル（合成ヒント） |

#### 肖像画の回廊（left）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `count_portrait` | 📦 アイテム取得 | noble_seal 取得 |
| `armor_display` | 🔓 パズルギミック | 剣・盾・兜を正しい位置に配置 |
| `secret_passage_a` | 🚪 隠し部屋遷移 | パズル解除後、隠し部屋Aへ |

#### 錬金術研究室（right）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `alchemical_apparatus` | 🧪 色合わせパズル | 3色の薬液を正しい順序で混合 |
| `herb_cabinet` | 📦 アイテム取得 | ancient_fragment 取得 |
| `magic_circle` | 🎨 視覚ヒント | 魔法陣に地下への扉が描かれている |

#### 使用人の通路（leftmost）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `service_stairs` | 🔐 数字パズル | 階段の数字を正しい順序でタップ |
| `storage_alcove` | 🎨 視覚ヒント | 窪みに薬草の絵が彫ってある |
| `underground_entrance` | 🚪 階層遷移 | chamber_key 消費で地下フロアへ |

#### 貴族の宝物庫（rightmost）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `golden_chest` | 🔐 宝箱パズル | 3桁の数字錠（他部屋のヒント） |
| `jeweled_crown` | 🔓 宝石配置パズル | 王冠の宝石を色と形で配置 |
| `treasure_map` | 🎨 視覚ヒント | 地図に隠し部屋Bの位置が描かれている |

### 隠し部屋設計

#### 隠し部屋A（armor_display解除後）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `hidden_garden` | 📦 アイテム取得 | mystic_herb 取得 |
| `ancient_mural` | 🎨 視覚ヒント | 壁画に隠し部屋Bへの手がかり |
| `exit_passage_a` | 🚪 部屋退出 | 肖像画の回廊に戻る |

#### 隠し部屋B（mystic_herb消費後）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `enhancement_altar` | 📦 アイテム取得 | enhancement_stone 取得 |
| `mystic_door` | 🔐 アイテム消費扉 | mystic_herb 消費で部屋進入可能 |
| `exit_passage_b` | 🚪 部屋退出 | 元の部屋に戻る |

---

## 🕳️ 地下詳細設計

### アイテム配置
```
基本部屋取得（2個）:
- ritual_crystal（儀式の水晶）- 古代祭壇の間
- sacred_stone（聖なる石）- 儀式の間

隠し部屋取得（2個）:
- ancient_power（古代の力）- 隠し部屋C ※パズル解除で進入
- pure_essence（純粋なる精髄）- 隠し部屋D ※ritual_crystal消費で進入

合成ルール:
sacred_stone + ancient_power + pure_essence → liberation_key
```

### ホットスポット配置（15箇所）

#### 古代祭壇の間（undergroundLeftmost）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `stone_altar` | 📦 アイテム取得 | ritual_crystal 取得 |
| `wall_inscriptions` | 🔐 シンボルパズル | 古代シンボルを正しい順序でタップ |
| `secret_passage_c` | 🚪 隠し部屋遷移 | パズル解除後、隠し部屋Cへ |

#### 儀式の間（undergroundLeft）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `grand_magic_circle` | 📦 アイテム取得 | sacred_stone 取得 |
| `crystal_formations` | 🔐 光線反射パズル | 水晶をタップして光線を特定場所に反射 |
| `ancient_braziers` | 🎨 視覚ヒント | 3つの炎台の配置が最終合成の順序を示す |

#### 地下神殿中央（undergroundCenter）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `temple_fountain` | 🎨 視覚ヒント | 泉の水面に最終合成の手順が映る |
| `stone_pillars` | 🔐 柱回転パズル | 柱の古代シンボルを同じ向きに揃える |
| `temple_seal` | ⚗️ 最終合成 | 地下合成場所 |

#### 古代文字の書庫（undergroundRight）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `stone_tablets` | 🎨 視覚ヒント | 石板に隠し部屋Dへの手がかりが描かれている |
| `scroll_collection` | 🔐 記号並べパズル | 古代文字を正しい配置に並べ替え |
| `reading_lectern` | 🎨 視覚ヒント | 書見台に解放の儀式の絵が描かれている |

#### 最終封印の間（undergroundRightmost）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `liberation_altar` | 🎨 視覚ヒント | 祭壇に最終合成のシンボルが描かれている |
| `ancient_guardian` | 🔐 石像パズル | 石像を特定の方向に向ける（床の矢印ヒント） |
| `crystal_gate` | 🔐 アイテム消費扉 | ritual_crystal 消費で隠し部屋Dアクセス |

### 隠し部屋設計

#### 隠し部屋C（wall_inscriptions解除後）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `power_crystal` | 📦 アイテム取得 | ancient_power 取得 |
| `ancient_scripts` | 🎨 視覚ヒント | 壁の文字が隠し部屋Dの場所を示す |
| `exit_passage_c` | 🚪 部屋退出 | 古代祭壇の間に戻る |

#### 隠し部屋D（ritual_crystal消費後）
| ホットスポットID | 機能 | 説明 |
|------------------|------|------|
| `essence_fountain` | 📦 アイテム取得 | pure_essence 取得 |
| `final_mural` | 🎨 視覚ヒント | 解放の儀式の完全な絵 |
| `exit_passage_d` | 🚪 部屋退出 | 最終封印の間に戻る |

---

## 📊 ゲームフロー詳細

### Phase 1: 1階攻略（20分）
```
1. noble_seal + ancient_fragment 取得（基本2個）
2. 甲冑パズル解除 → 隠し部屋A → mystic_herb 取得
3. mystic_herb 消費 → 隠し部屋B → enhancement_stone 取得
4. 大図書室で合成 → chamber_key 作成
5. chamber_key 消費 → 地下進入
```

### Phase 2: 地下攻略（18分）
```
1. ritual_crystal + sacred_stone 取得（基本2個）
2. 古代シンボルパズル解除 → 隠し部屋C → ancient_power 取得
3. ritual_crystal 消費 → 隠し部屋D → pure_essence 取得
4. 地下神殿中央で合成 → liberation_key 作成
```

### Phase 3: 脱出（2分）
```
1. 大図書室に戻る
2. liberation_key 消費 → 正面扉から脱出成功
```

## 📈 インベントリ管理

### 1階フロー
```
開始: 0個 → noble_seal: 1個 → ancient_fragment: 2個 
→ mystic_herb: 3個 → mystic_herb消費: 2個 → enhancement_stone: 3個
→ 合成: 1個 → chamber_key消費: 0個

最大保持: 3個
```

### 地下フロー
```
開始: 0個 → ritual_crystal: 1個 → sacred_stone: 2個
→ ancient_power: 3個 → ritual_crystal消費: 2個 → pure_essence: 3個
→ 合成: 1個 → liberation_key消費: 0個

最大保持: 3個
```

## 🎯 隠し部屋必須化システム

### 依存関係
```
隠し部屋A: 甲冑パズル解除が必要
隠し部屋B: mystic_herb（隠し部屋Aアイテム）消費が必要
隠し部屋C: 古代シンボルパズル解除が必要  
隠し部屋D: ritual_crystal（地下基本アイテム）消費が必要

→ 4つ全ての隠し部屋探索が必須
```

## 🎨 視覚ヒントシステム

### ヒント配置戦略
- **合成ヒント**: 本・祭壇・壁画に必要アイテムの絵
- **パズルヒント**: 色・形・数字・方向を視覚的に表示
- **進行ヒント**: 地図・矢印・シンボルで次の場所を示唆
- **ストーリーヒント**: 壁画・彫刻で物語の背景を表現

## ⚙️ 技術要件

### 実装優先度

#### 高優先（Phase 1）
1. 基本5部屋のホットスポット実装
2. アイテム取得・消費システム
3. 基本パズルギミック実装
4. インベントリシステム（3個制限）

#### 中優先（Phase 2）
1. 隠し部屋システム実装
2. アイテム消費による扉開放システム
3. 合成システム実装
4. 階層遷移システム

#### 低優先（Phase 3）
1. 視覚ヒントシステム実装
2. 背景画像統合
3. 効果音・BGM統合
4. パフォーマンス最適化

### 開発制約
- 背景画像: 400x600統一
- ホットスポット座標: 背景サイズ基準で設定
- アイテム管理: InventorySystemシングルトン使用
- 状態管理: 既存のゲーム状態システムと統合

## 🎮 ユーザー体験設計

### 難易度カーブ
- **序盤（1階）**: 基本操作習得、簡単なパズル
- **中盤（地下）**: 複雑なパズル、戦略的アイテム使用
- **終盤（合成・脱出）**: 全要素の統合、達成感

### プレイヤー誘導
1. 直感的な操作（タップのみ）
2. 視覚的フィードバック（ハイライト・アニメーション）
3. 段階的な難易度上昇
4. 明確な進行感（アイテム取得・部屋開放）

---

## 📝 実装チェックリスト

### システム実装
- [ ] InventorySystem（3個制限）
- [ ] HotspotSystem（45箇所対応）
- [ ] ItemCombinationSystem（2種類の合成）
- [ ] HiddenRoomAccessSystem（4部屋対応）
- [ ] FloorTransitionSystem（1階⇔地下）

### コンテンツ実装
- [ ] 背景画像（14枚：基本10部屋+隠し4部屋）
- [ ] アイテム画像（8種類）
- [ ] パズルギミック（10種類以上）
- [ ] 視覚ヒント（15種類以上）
- [ ] SE・BGM統合

### テスト項目
- [ ] 全フロー通しテスト
- [ ] インベントリ制限テスト
- [ ] 隠し部屋必須化テスト
- [ ] アイテム消費テスト
- [ ] パフォーマンステスト

---

この設計書に基づいて段階的実装を進行し、各Phase完了時に動作確認とテストを実施する予定です。